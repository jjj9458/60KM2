## 專案重點要求

1.  佈署於 GitHub Pages (`github.io`) 上，以便於使用者訪問和使用。
2.  README.md 僅供參考，還未更新

# 九萬啟插爆聯盟系統 README

## 系統概覽

本系統透過 `index.html` 定義使用者介面，`css/style.css` 提供樣式，`js/app.js` 處理所有動態互動與資料邏輯。主要功能包括：

*   **多語言介面**：支援繁體中文與英文。
*   **驗證碼存取**：不同功能區塊（報名、專武、管理）透過驗證碼控制。
*   **使用者資料表單**：
    *   **報名系統**：收集 UID、暱稱、段位、課金意願、身分、期望小組等。
    *   **專武登記**：收集 UID、座標、兵種、專武選擇。
*   **即時資料列表**：報名成功後，列表會即時更新。
*   **資料統計與顯示**：
    *   「詳細資料」頁面根據管理員設定的人數，顯示 A/B/C 盟的隊員列表和專武統計。
*   **地圖視覺化**：
    *   「地圖」頁面顯示專武座標，提供篩選及縮放功能。
*   **管理員功能**：
    *   設定系統參數（主要活動驗證碼、日期、進場人數、特殊項目名額）。
    *   自動團隊分配功能。
*   **資料儲存**：所有使用者資料和部分設定均儲存在 **Firebase Realtime Database** 中。

## 如何使用

1.  直接在瀏覽器中打開 `index.html` 檔案即可開始使用（建議透過 Live Server 或部署後訪問）。
2.  根據提示輸入對應的驗證碼以啟用「報名」或「專武登記+詳細資料+地圖」功能。
    *   報名功能預設驗證碼: `AAA`
    *   專武/詳情/地圖預設驗證碼: `BBB`
    *   管理員功能預設驗證碼: `基佬閣`
3.  你可以切換語言，填寫報名表，登記專武，查看地圖和統計資料。
4.  如果知道管理員驗證碼，可以進入管理員介面進行系統設定和團隊分配。

## 專案結構

```
.
├── css/
│   └── style.css         # 控制網頁的全部樣式
├── js/
│   ├── app.js            # 網頁的所有互動功能和資料處理
├── index.html            # 網站的主要頁面結構
└── README.md             # 專案說明文件
```

## 檔案功能說明

### 1. `index.html`

這是網站的入口檔案，定義了網頁的基本骨架和各個功能區塊的靜態內容。它包含了：

*   網頁標題和頂部操作列（語言切換、管理員按鈕、刷新）。
*   驗證碼輸入介面。
*   導覽列，用於切換「報名」、「專武登記」、「詳細資料」、「地圖」、「管理員設定」等功能視圖。
*   各個視圖的表單（如報名表、專武登記表）和資料顯示區域（如報名列表、統計表格、地圖容器）。
*   Firebase SDK 的引入和初始化配置。
*   全域 `eventCode` 變數的初始化（與管理員設定的「報名表驗證碼」關聯）。

### 2. `css/style.css`

此檔案負責網頁的視覺樣式，包括顏色、排版、元件外觀、動畫及響應式設計。

### 3. `js/app.js`

這是系統的核心，處理所有互動和資料邏輯：

*   **多語言支援 (I18N)**：根據使用者選擇動態更新介面文字。
*   **頁面導覽與驗證碼存取**：控制不同功能視圖的顯示，並根據驗證碼授權。
*   **表單處理與 Firebase 資料互動**：
    *   **報名表單 (`#signupForm`)**：
        *   收集玩家資訊。
        *   提交時，檢查 UID 是否已存在於 Firebase Realtime Database 的 `events/{eventCode}/signups/{uid}`。
        *   若 UID 已存在，則更新該 UID 的資料；若不存在，則創建新記錄並更新 `events/{eventCode}/counter`。
        *   成功後提示「報名成功！」或「資料已修改！」。
    *   **專武登記表單 (`#weaponForm`)**：
        *   收集玩家 UID 及專武資訊。
        *   提交時，若 UID 在資料庫中不存在，則直接為該 UID 創建新記錄（包含專武資訊）並更新 counter；若 UID 已存在，則更新或補充其專武資訊。
        *   根據操作成功提示「專武登記成功！」、「專武首次登記成功！」或「專武資料修改成功！」。
    *   所有核心玩家資料（報名與專武）都存儲在 Firebase Realtime Database 的 `events/{eventCode}/signups/{uid}` 路徑下。
*   **動態資料顯示與更新**：
    *   `refreshSignupList()`：從 Firebase 讀取資料並更新報名列表。
    *   `refresh()`：從 Firebase 讀取資料，處理隊伍分配邏輯，並更新「詳細資料」頁的統計數據和隊伍列表。
    *   `updateTable()` 和 `updateWeaponStats()`：輔助函數，用於將資料渲染到 HTML 表格中。
*   **管理員功能 (`#admin` 區塊)**：
    *   **設定管理**：
        *   允許管理員設定主要活動驗證碼 (`verifyCodeA`，影響 `eventCode`)、專武統計用驗證碼 (`verifyCodeB`)、開局日期、報名截止日期、進場人數、特殊項目名額等。
        *   這些設定主要儲存在瀏覽器的 `localStorage` 中（鍵名 `clownSettings`），並在需要時被讀取以影響系統行為（如 `eventCode` 的確認、隊伍分配、報名人數上限等）。
    *   **團隊自動分配**：基於當前報名資料和人數設定進行分組，結果顯示並可複製。
*   **地圖功能 (`#map` 區塊)**：
    *   初始化地圖篩選器、繪製座標軸、處理縮放。
    *   （預期從 Firebase 讀取專武資料中的座標並顯示在地圖上）。
*   **其他**：全域 `eventCode` 變數的管理、錯誤處理、UI互動等。

## Firebase Realtime Database 結構概要

主要的資料存儲在 Firebase Realtime Database 中，其基本結構如下：

```json
{
  "events": {
    "{eventCode}": { // 例如 "AAA"，由管理員設定的報名驗證碼決定
      "counter": 120, // 當前總報名人數 (整數)
      "signups": {
        "{uid1}": {    // 以玩家 UID 作為 Key
          "uid": "{uid1}",
          "nickname": "玩家暱稱",
          "rank": "gold",         // 段位 (例如: gold, silver)
          "rankMinor": "1",       // 小段位 (例如: 1, 2, 3)
          "payPower": "yes",      // 是否課金 (yes/no)
          "roleGroup": "core",    // 身分組 (例如: newbie, core)
          "introName": "介紹人 (如果有的話)",
          "lang": "zh",           // 報名時使用的語言
          "expectSquad": "期望小A隊", // 期望小組
          "posX": 100,            // X 座標 (整數)
          "posY": 200,            // Y 座標 (整數)
          "troopsNormal": "spear",// 預計兵類 (例如: spear, bow)
          "troopsSpecial": "mole",// 特殊兵種 (如果 troopsNormal 是 special)
          "troopsMerge": "長槍",  // 融專兵種名稱
          "signupOrder": 1,       // 報名次序 (自動遞增的整數)
          "squadNo": null,        // 小組編號 (預期由演算法產生，目前可能為 null)
          "ts": 1678886400000    // Server Timestamp (上次更新/創建的時間戳)
        },
        "{uid2}": {
          // ... 其他玩家資料
        }
      }
    }
  }
}
```

## 先前版本檢查點 (截至 2024-07-29，部分可能已更新)

以下為切換到 Firebase 前，基於 `localStorage` 版本時的一些觀察點，部分可能已隨架構調整而改變或解決：

*   **ID 不匹配問題**：曾有 HTML 元素 ID 與 JavaScript 中引用的不一致情況，需持續留意確保同步。
*   **功能未完整或已損壞**：
    *   「詳細資料頁的未填寫名單」：`unfilledA`, `unfilledB`, `unfilledC` 的動態產生邏輯需要根據 Firebase 資料重新審視和實現。
*   **翻譯鍵缺失**：部分動態生成的 UI 可能需要檢查 `I18N` 物件中是否有對應翻譯。
*   **全域變數使用**：如 `window.selectedWeapon`，需謹慎管理。
*   **使用者介面模式**：部分 `prompt()` 使用可以考慮替換為更現代的 UI 互動方式。
*   **開發用程式碼殘留**：`console.log` 等應在生產環境移除。

---

希望這份更新後的 README 能更好地反映專案的目前狀態！

